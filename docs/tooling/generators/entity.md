# Entity Generator

**Status**: ğŸŸ  [Not yet implemented](../status.md) â€” this is the specification.

See [docs/ddd-implementation/primitives/entity/specification.md](../../ddd-implementation/primitives/entity/specification.md) for full details.

## Quick Start

```bash
nx generate @local/ddd:entity --context=orders --name=Order --idType=OrderId
```

Creates:
```
src/core/orders/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ Order.ts (generated)
â”‚   â””â”€â”€ value-objects/
â”‚       â””â”€â”€ OrderId.ts (must exist or be created separately)
â””â”€â”€ tests/
    â””â”€â”€ unit/
        â””â”€â”€ domain/
            â””â”€â”€ entities/
                â””â”€â”€ Order.spec.ts (generated)
```

See [TEMPLATE.md](TEMPLATE.md) for common patterns (base class, private constructor, Result type, etc).

## Generated Structure

### Entity Class
```typescript
export class Order extends BaseEntity<OrderId> {
  private constructor(
    readonly id: OrderId,
    readonly customerId: string,
    readonly items: OrderItem[],
    readonly status: OrderStatus,
  ) {
    super(id);
  }

  static create(
    customerId: string,
    items: OrderItem[],
  ): Result<Order, DomainError> {
    // Validation...
    return Result.ok(new Order(
      new OrderId(generateId()),
      customerId,
      items,
      'pending',
    ));
  }

  // Business methods...
  confirmOrder(): Result<void, DomainError> {
    // Check invariants, possibly raise event
    return Result.ok();
  }
}
```

### Test Template
```typescript
describe('Order', () => {
  describe('create', () => {
    it('should create valid order', () => {
      const result = Order.create('cust-123', [
        { sku: 'WIDGET', quantity: 5 },
      ]);
      expect(result.isSuccess).toBe(true);
    });
  });

  describe('invariants', () => {
    it('should enforce at least one item', () => {
      // Test that empty items array fails
    });
  });

  describe('business methods', () => {
    it('should confirm order when valid', () => {
      // Test confirmOrder() logic
    });
  });
});
```

## Key Features

- âœ… Extends `BaseEntity<TId>` (aggregate root)
- âœ… Brand ID type (e.g., `OrderId`)
- âœ… Private constructor + static factory
- âœ… All fields readonly
- âœ… Returns `Result<Entity, DomainError>`
- âœ… Includes unit test stub
- âœ… Supports domain event collection via `BaseEntity`
- âœ… Invariant enforcement (business rules)

## Related Documentation

- [Entity specification](../../ddd-implementation/primitives/entity/specification.md)
- [Entity enforcement](../../ddd-implementation/primitives/entity/enforcement.md)
- [Aggregate root pattern](../../ddd-implementation/primitives/aggregate-root/specification.md)
- [Brand IDs](../../ddd-implementation/primitives/entity/specification.md#identity)

---

See [generators/README.md](README.md) for overview of all generators.

## Template: {Name}.specification.md (generate alongside the entity)

Use this exact content when scaffolding the instance-level spec for an entity. Keep it delta-focused; defer to the parent spec for general rules.

```markdown
# {Name} Entity Specification

**Parent spec**: ../../ddd-implementation/primitives/entity/specification.md  
**Purpose**: capture only instance-specific details; omit anything identical to the parent.

## What this entity represents (1â€“2 sentences)
- [FILL IN: business meaning]
- [FILL IN: why it exists in this bounded context]

## Identity and aggregate membership
- [FILL IN: ID type (e.g., OrderId) and generation rules]
- [FILL IN: whether it is an aggregate root or child]

## State shape and invariants
- [FILL IN: required fields and semantics]
- [FILL IN: invariants/cross-field rules enforced here]
- [FILL IN: collections cardinality rules]

## Behaviors and domain events
- [FILL IN: key behaviors/methods; emitted events]
- [FILL IN: side effects/observers relying on events]

## Lifecycle & persistence
- [FILL IN: creation rules; rehydration expectations]
- [FILL IN: versioning/concurrency notes if special]

## Error and validation cases (instance-specific)
- [FILL IN: validation failures or business rejections unique here]

## Observability (only if special)
- [FILL IN or â€œNoneâ€]

## Related docs
- Parent: ../../ddd-implementation/primitives/entity/specification.md
- Neighbors: [FILL IN other relevant specs]

**Generated by**: nx generate @local/ddd:entity --context={context} --name={name}  
**Last updated**: [Auto-generated date]
```

## Template: {Name}.enforcement.md (generate alongside the entity)

Generate this file verbatim. It documents instance-specific guardrails beyond the parent enforcement contract.

```markdown
# {Name} Entity Enforcement

**Parent enforcement**: ../../ddd-implementation/primitives/entity/enforcement.md  
**Purpose**: capture only what is unique to this entity; the parent already enforces the rest.

## Why this entity is sensitive
- [FILL IN: critical path (revenue/safety/regulatory)]
- [FILL IN: behaviors/events downstream depend on]

## Required shape & schema deltas
- [FILL IN: fields that must not be removed/renamed; semantics]
- [FILL IN: invariants specific to this entity]

## Aggregate and identity rules
- [FILL IN: ID constraints; aggregate root boundaries]
- [FILL IN: version/concurrency requirements if special]

## Safe changes checklist (impact map)
- If fields change: update factory, invariants, persistence mappers, serializers, tests
- If events/behaviors change: update listeners, policies, contracts, tests
- If identity/aggregate boundary changes: update repositories, use cases, tests

## Minimal tests required
- Factory/creation: happy path + key invariant failures
- Behavior: method-level tests for domain rules and emitted events
- Persistence/rehydration (if applicable): round-trip of critical fields

## Collaborators
- Callers: [FILL IN: which factories/use cases construct/use it]
- Consumers: [FILL IN: listeners depending on its events/state]

## Anti-patterns (instance-specific)
- [FILL IN: unique bans beyond parent]

## Observability (only if special)
- [FILL IN tracing/logging requirements] or â€œNoneâ€

**Generated by**: nx generate @local/ddd:entity --context={context} --name={name}  
**Last updated**: [Auto-generated date]
```
